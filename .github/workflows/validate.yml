name: Validate Skill

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyyaml
        
    - name: Run validation
      run: |
        python host_scripts/validate.py
        
    - name: Check YAML syntax
      run: |
        python << 'PYTHON_SCRIPT'
        import yaml
        import sys
        from pathlib import Path

        errors = []
        for yaml_file in Path(".").rglob("*.yaml"):
            if "node_modules" in str(yaml_file):
                continue
            try:
                with open(yaml_file) as f:
                    yaml.safe_load(f)
                print(f"✓ {yaml_file}")
            except Exception as e:
                errors.append(f"{yaml_file}: {e}")
                print(f"✗ {yaml_file}: {e}")

        if errors:
            print(f"\n❌ {len(errors)} YAML file(s) have errors")
            sys.exit(1)
        else:
            print(f"\n✅ All YAML files valid")
        PYTHON_SCRIPT
